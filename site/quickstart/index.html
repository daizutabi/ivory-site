<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="daizutabi">
    <link rel="shortcut icon" href="../img/favicon.ico">
    <title>Quickstart &mdash; Ivory</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <link rel="stylesheet" href="../css/mkapi.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../css/pheasant.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href=".." class="site-name"> Ivory</a>
                </div><div class="version">0.3.1</div>
                <div class="search">
                    <div role="search">
    <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
        <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
    </form>
</div>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="..">Ivory Documentation</a></li>
                    <li class="toctree-l1 current"><a class="nav-item current" href="./">Quickstart</a>
<ul class="subnav">
<li class="toctree-l2"><a class="nav-item toc" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#using-an-ivory-client">Using an Ivory Client</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#create-numpy-data">Create NumPy data</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#set-of-data-classes">Set of Data classes</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#define-a-model">Define a model</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#parameter-file-for-run">Parameter file for Run</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#train-a-model">Train a model</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#test-a-model">Test a model</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#task-for-multiple-runs">Task for multiple runs</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#collect-runs">Collect runs</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#load-runs-and-results">Load runs and results</a></li>
<li class="toctree-l2"><a class="nav-item toc" href="#summary">Summary</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">Tutorial</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/data/">Set of Data classes</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/instance/">Creating Instances</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/model/">Model Structure</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/callback/">Callback System</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/training/">Training a Model</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/core/">Ivory Core Entities</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/task/">Multiple Runs</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/tuning/">Hyperparameter Tuning</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/ui/">Tracking UI</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/tracking/">Tracking Runs with Ivory</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/library/">Library Comparison</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../tutorial/cli/">Command Line Interface</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">Python API</button>
<ul class="subnav">
    <li class="toctree-l2"><button class="section nav-item hide">ivory.core</button>
<ul class="subnav hide">
    <li class="toctree-l3">
<a class="nav-item" href="../api/ivory.core.data/">Ivory.core.data</a></li>
    <li class="toctree-l3">
<a class="nav-item" href="../api/ivory.core.base/">Ivory.core.base</a></li>
    <li class="toctree-l3">
<a class="nav-item" href="../api/ivory.core.client/">Ivory.core.client</a></li>
    <li class="toctree-l3">
<a class="nav-item" href="../api/ivory.core.run/">Ivory.core.run</a></li>
</ul></li>
</ul></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
        <a href="https://github.com/daizutabi/ivory/" class="fa fa-github"> GitHub</a>
    </div>
    <div class="previous"><a href="..">&laquo; Previous</a></div>
    <div class="next"><a href="../tutorial/data/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href=".." class="site-name"> Ivory</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    
</ul>
</nav>
                <div id="content">
<h1 id="quickstart"><span class="pheasant-header"><span class="header"><span class="title">Quickstart</span></span></span></h1>
<h2 id="installation"><span class="pheasant-header"><span class="header"><span class="title">Installation</span></span></span></h2>
<p>Install Ivory using <code>pip</code>.</p>
<div class="pheasant-fenced-code"><div class="cell embed terminal"><div class="code"><pre><code class="bash">$ pip install ivory</code></pre></div></div></div>

<h2 id="using-an-ivory-client"><span class="pheasant-header"><span class="header"><span class="title">Using an Ivory Client</span></span></span></h2>
<p>Ivory has the <code>Client</code> class that manages the workflow of machine learning. Let's create your first <code>Client</code> instance. In this quickstart, we are working with examples under the <code>examples</code> directory.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import ivory

client = ivory.create_client(&#34;examples&#34;)
client</code></pre></div>
<div class="report"><p><span class="count">[3]</span>
<span class="start">2020-06-01 09:54:03</span> (<span class="time">1.02s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.06s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Client(num_instances=2)</code></pre></div></div></div></div>

<p>The representation of the <code>client</code> shows that it has two objects. These objects can be accessed by <em>index notation</em> or <em>dot notation</em>.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">client[0]  # or client[&#39;tracker&#39;], or client.tracker</code></pre></div>
<div class="report"><p><span class="count">[4]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.07s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Tracker(tracking_uri=&#39;file:///C:/Users/daizu/Documents/github/ivory/examples/mlruns&#39;, artifact_location=None)</code></pre></div></div></div></div>

<p>The first object is a <code>Tracker</code> instance which connects Ivory to <a href="https://mlflow.org/docs/latest/tracking.html">MLFlow Tracking</a>.</p>
<p>Because a <code>Client</code> instance is an iterable, you can get all of the objects by applying <code>list()</code> to it.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">list(client)</code></pre></div>
<div class="report"><p><span class="count">[5]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">5.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.07s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">[&#39;tracker&#39;, &#39;tuner&#39;]</code></pre></div></div></div></div>

<p>The second objects is named <code>tuner</code>.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">client.tuner</code></pre></div>
<div class="report"><p><span class="count">[6]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">3.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.08s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Tuner(storage=&#39;sqlite://&#39;, sampler=None, pruner=None, load_if_exists=True)</code></pre></div></div></div></div>

<p>A <code>Tuner</code> instance connects Ivory to <a href="https://preferred.jp/en/projects/optuna/">Optuna: A hyperparameter optimization framework</a>.</p>
<p>We can customize these objects with a YAML file named <code>client.yml</code> under the woking directory.  In our case, the file just contains the minimum settings.</p>
<div class="pheasant-header"><div class="other"><p class="caption"><span class="prefix">File</span> <span class="number">1</span>
<span class="title">client.yml</span></p>
<div class="content">

<div class="pheasant-fenced-code"><div class="cell embed file"><div class="code"><pre><code class="yaml">client:
  tracker:
  tuner:</code></pre></div></div></div>

</div></div></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A YAML file for client is not required. If there is no file for client, Ivory creates a default client with a tracker and without a tuner.</p>
<p>If you don't need a tracker, for example in debugging, use <code>ivory.create_client(tracker=False)</code>.</p>
</div>
<h2 id="create-numpy-data"><span class="pheasant-header"><span class="header"><span class="title">Create NumPy data</span></span></span></h2>
<p>In this quickstart, we try to predict rectangles area from thier width and height using <a href="https://pytorch.org/">PyTorch</a>. First, prepare the data as <a href="https://numpy.org/">NumPy</a> arrays. In <code>rectangle/data.py</code> under the working directory, a <code>create_data()</code> function is defined. The <code>ivory.create_client()</code> function automatically inserts the working directory to <code>sys.path</code>, so that we can import the module regardless of the current directory.</p>
<p>Let's check the <code>create_data()</code> function defined in <code>rectangle/data.py</code> and an example output:</p>
<div class="pheasant-header"><div class="other"><p class="caption"><span class="prefix">File</span> <span class="number">2</span>
<span class="title">rectangle/data.py</span></p>
<div class="content">

<div class="pheasant-fenced-code"><div class="cell embed file"><div class="code"><pre><code class="python">from dataclasses import dataclass

import numpy as np

import ivory.core.data
from ivory.utils.fold import kfold_split


def create_data(num_samples=1000):
    xy = 4 * np.random.rand(num_samples, 2) + 1
    xy = xy.astype(np.float32)
    dx = 0.1 * (np.random.rand(num_samples) - 0.5)
    dy = 0.1 * (np.random.rand(num_samples) - 0.5)
    z = ((xy[:, 0] + dx) * (xy[:, 1] + dy)).astype(np.float32)
    return xy, z


@dataclass(repr=False)
class Data(ivory.core.data.Data):
    n_splits: int = 4

    DATA = create_data(1000)  # Shared by each run.

    def init(self):  # Called from self.__post_init__()
        self.input, self.target = self.DATA
        self.index = np.arange(len(self.input))
        # Extra fold for test data.
        self.fold = kfold_split(self.input, n_splits=self.n_splits + 1)

        # Creating dummy test data just for demonstration.
        is_test = self.fold == self.n_splits  # Use an extra fold.
        self.fold[is_test] = -1  # -1 for test data.
        self.target = self.target.copy()  # n_splits may be different among runs.
        self.target[is_test] = np.nan  # Delete target for test data.

        self.target = self.target.reshape(-1, 1)  # (sample, class)


def transform(mode, input, target):
    return input, target.reshape(-1)</code></pre></div></div></div>

</div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import rectangle.data

xy, z = rectangle.data.create_data(4)
xy</code></pre></div>
<div class="report"><p><span class="count">[8]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">5.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.09s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">array([[3.0430295, 1.3610351],
       [1.3537742, 4.0308967],
       [2.381003 , 1.6470485],
       [4.9292455, 3.232341 ]], dtype=float32)</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">z</code></pre></div>
<div class="report"><p><span class="count">[9]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">3.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.09s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">array([ 4.0553718,  5.600313 ,  3.7484245, 16.133295 ], dtype=float32)</code></pre></div></div></div></div>

<h2 id="set-of-data-classes"><span class="pheasant-header"><span class="header"><span class="title">Set of Data classes</span></span></span></h2>
<p>Ivory defines a set of Data classes (<code>Data</code>, <code>Dataset</code>, <code>Datasets</code>). But now, we use the <code>Data</code> class only.</p>
<p>In the above file, the <code>kfold_split()</code> function creates a fold array.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import numpy as np
from ivory.utils.fold import kfold_split

kfold_split(np.arange(10), n_splits=3)</code></pre></div>
<div class="report"><p><span class="count">[10]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.10s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">array([2, 1, 0, 2, 0, 2, 1, 1, 0, 0], dtype=int8)</code></pre></div></div></div></div>

<p>Now, we can get a <code>Data</code> instance.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">data = rectangle.data.Data()
data</code></pre></div>
<div class="report"><p><span class="count">[11]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">5.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.10s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Data(train_size=800, test_size=200)</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">data.get(0)  # get data of index = 0.</code></pre></div>
<div class="report"><p><span class="count">[12]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.10s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">(0,
 array([2.3092778, 3.8929958], dtype=float32),
 array([9.130621], dtype=float32))</code></pre></div></div></div></div>

<p>This returned value is a tuple of (index, input, target). Ivory always keeps data index so that we can know where a sample comes from.</p>
<h2 id="define-a-model"><span class="pheasant-header"><span class="header"><span class="title">Define a model</span></span></span></h2>
<p>We use a simple MLP model here.</p>
<div class="pheasant-header"><div class="other"><p class="caption"><span class="prefix">File</span> <span class="number">3</span>
<span class="title">rectangle/torch.py</span></p>
<div class="content">

<div class="pheasant-fenced-code"><div class="cell embed file"><div class="code"><pre><code class="python">import torch.nn as nn
import torch.nn.functional as F


class Model(nn.Module):
    def __init__(self, hidden_sizes):
        super().__init__()
        layers = []
        for in_features, out_features in zip([2] + hidden_sizes, hidden_sizes + [1]):
            layers.append(nn.Linear(in_features, out_features))
        self.layers = nn.ModuleList(layers)

    def forward(self, x):
        for layer in self.layers[:-1]:
            x = F.relu(layer(x))
        return self.layers[-1](x)</code></pre></div></div></div>

</div></div></div>

<h2 id="parameter-file-for-run"><span class="pheasant-header"><span class="header"><span class="title">Parameter file for Run</span></span></span></h2>
<p>Ivory configures a run using a YAML file. Here is a full example.</p>
<div class="pheasant-header"><div class="other"><p class="caption"><span class="prefix">File</span> <span class="number">4</span>
<span class="title">torch.yaml</span></p>
<div class="content">

<div class="pheasant-fenced-code"><div class="cell embed file"><div class="code"><pre><code class="yaml">library: torch
datasets:
  data:
    class: rectangle.data.Data
    n_splits: 4
  dataset:
  fold: 0
model:
  class: rectangle.torch.Model
  hidden_sizes: [20, 30]
optimizer:
  class: torch.optim.SGD
  params: $.model.parameters()
  lr: 1e-3
scheduler:
  class: torch.optim.lr_scheduler.ReduceLROnPlateau
  optimizer: $
  factor: 0.5
  patience: 4
results:
metrics:
monitor:
  metric: val_loss
early_stopping:
  patience: 10
trainer:
  loss: mse
  batch_size: 10
  epochs: 10
  shuffle: true
  verbose: 2</code></pre></div></div></div>

</div></div></div>

<p>Let's create a run by <code>Client.create_run()</code></p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run = client.create_run(&#39;torch&#39;)
run</code></pre></div>
<div class="report"><p><span class="count">[14]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">283ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.66s</span>)</span></p></div></div><div class="cell jupyter stderr"><div class="code">
      <pre><code class="nohighlight">[I 200601 09:54:04 tracker:48] A new experiment created with name: &#39;torch&#39;</code></pre></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Run(id=&#39;dabd9f41552743718f346c00a70636ce&#39;, name=&#39;run#0&#39;, num_instances=12)</code></pre></div></div></div></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>Client.create_run(&lt;name&gt;)</code> creates an experiment named <code>&lt;name&gt;</code> if it hasn't existed yet. By cliking an icon (<i class="far fa-eye-slash" style="font-size:0.8rem; color: #ff8888;"></i>) in the above cell, you can see the log.</p>
<p>Or you can directly create an experiment then make the experiment create a run:</p>
<div class="highlight"><pre><span></span><code><span class="n">experiment</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_experiment</span><span class="p">(</span><span class="s1">&#39;torch&#39;</span><span class="p">)</span>
<span class="n">run</span> <span class="o">=</span> <span class="n">experiment</span><span class="o">.</span><span class="n">create_run</span><span class="p">()</span>
</code></pre></div>

</div>
<p>A <code>Run</code> instance have a <code>params</code> attribute that holds the parameters for the run.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import yaml

print(yaml.dump(run.params, sort_keys=False))</code></pre></div>
<div class="report"><p><span class="count">[15]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">7.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.66s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">run:
  datasets:
    data:
      class: rectangle.data.Data
      n_splits: 4
    dataset:
      def: ivory.torch.data.Dataset
    fold: 0
    class: ivory.core.data.Datasets
  model:
    class: rectangle.torch.Model
    hidden_sizes:
    - 20
    - 30
  optimizer:
    class: torch.optim.SGD
    params: $.model.parameters()
    lr: 0.001
  scheduler:
    class: torch.optim.lr_scheduler.ReduceLROnPlateau
    optimizer: $
    factor: 0.5
    patience: 4
  results:
    class: ivory.torch.results.Results
  metrics:
    class: ivory.torch.metrics.Metrics
  monitor:
    metric: val_loss
    class: ivory.callbacks.monitor.Monitor
  early_stopping:
    patience: 10
    class: ivory.callbacks.early_stopping.EarlyStopping
  trainer:
    loss: mse
    batch_size: 10
    epochs: 10
    shuffle: true
    verbose: 2
    class: ivory.torch.trainer.Trainer
  class: ivory.torch.run.Run
  name: run#0
  id: dabd9f41552743718f346c00a70636ce
experiment:
  name: torch
  class: ivory.core.base.Experiment
  id: &#39;1&#39;</code></pre></div></div></div></div>

<p>This is similar to the YAML file we read before, but is slightly changed by the Ivory Client.</p>
<ul>
<li>Run and experiment sections are inserted.</li>
<li>ExperimentID and RunID are assigned by MLFlow Tracking.</li>
<li>Default classes are specified, for example <code>ivory.torch.trainer.Trainer</code> for a <code>trainer</code> instance.</li>
</ul>
<p>The <code>Client.create_run()</code> method can take keyword arguments to modify these parameters:</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run = client.create_run(
  &#39;torch&#39;, fold=3, hidden_sizes=[40, 50, 60],
)

print(&#39;[datasets]&#39;)
print(yaml.dump(run.params[&#39;run&#39;][&#39;datasets&#39;], sort_keys=False))
print(&#39;[model]&#39;)
print(yaml.dump(run.params[&#39;run&#39;][&#39;model&#39;], sort_keys=False))</code></pre></div>
<div class="report"><p><span class="count">[16]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">46.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">1.71s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">[datasets]
data:
  class: rectangle.data.Data
  n_splits: 4
dataset:
  def: ivory.torch.data.Dataset
fold: 3
class: ivory.core.data.Datasets

[model]
class: rectangle.torch.Model
hidden_sizes:
- 40
- 50
- 60</code></pre></div></div></div></div>

<h2 id="train-a-model"><span class="pheasant-header"><span class="header"><span class="title">Train a model</span></span></span></h2>
<p>Once you got a run instance, then all you need is to start it.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run = client.create_run(&#39;torch&#39;)  # Back to the default settings.
run.start()</code></pre></div>
<div class="report"><p><span class="count">[17]</span>
<span class="start">2020-06-01 09:54:04</span> (<span class="time">1.30s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3.02s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">[epoch#0] loss=24.6 val_loss=9.659 lr=0.001 best
[epoch#1] loss=8.129 val_loss=8.593 lr=0.001 best
[epoch#2] loss=7.007 val_loss=7.098 lr=0.001 best
[epoch#3] loss=5.537 val_loss=5.362 lr=0.001 best
[epoch#4] loss=4.504 val_loss=4.141 lr=0.001 best
[epoch#5] loss=3.26 val_loss=2.945 lr=0.001 best
[epoch#6] loss=2.349 val_loss=2.108 lr=0.001 best
[epoch#7] loss=1.543 val_loss=1.379 lr=0.001 best
[epoch#8] loss=1.109 val_loss=1.091 lr=0.001 best
[epoch#9] loss=0.9177 val_loss=0.8655 lr=0.001 best</code></pre></div></div></div></div>

<p>The history of metrics is saved as the <code>history</code> attribute of a <code>run.metrics</code> instance.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run.metrics.history</code></pre></div>
<div class="report"><p><span class="count">[18]</span>
<span class="start">2020-06-01 09:54:06</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3.02s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Dict([&#39;loss&#39;, &#39;val_loss&#39;, &#39;lr&#39;])</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run.metrics.history.val_loss</code></pre></div>
<div class="report"><p><span class="count">[19]</span>
<span class="start">2020-06-01 09:54:06</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3.02s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">{0: 9.65923455953598,
 1: 8.592841076850892,
 2: 7.097892558574676,
 3: 5.362466168403626,
 4: 4.1406551718711855,
 5: 2.9451513200998307,
 6: 2.108333858847618,
 7: 1.3789284825325012,
 8: 1.090790931880474,
 9: 0.8655212059617042}</code></pre></div></div></div></div>

<p>Also the model output and target are automatically collected in a <code>run.results</code> instance.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run.results</code></pre></div>
<div class="report"><p><span class="count">[20]</span>
<span class="start">2020-06-01 09:54:06</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3.03s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Results([&#39;train&#39;, &#39;val&#39;])</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run.results.val.output[:5]</code></pre></div>
<div class="report"><p><span class="count">[21]</span>
<span class="start">2020-06-01 09:54:06</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3.03s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">array([[ 3.8852103],
       [ 2.474671 ],
       [ 1.561607 ],
       [ 4.468973 ],
       [18.509363 ]], dtype=float32)</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run.results.val.target[:5]</code></pre></div>
<div class="report"><p><span class="count">[22]</span>
<span class="start">2020-06-01 09:54:06</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3.04s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">array([[ 3.7601159],
       [ 2.86758  ],
       [ 2.3021314],
       [ 4.1624484],
       [19.973352 ]], dtype=float32)</code></pre></div></div></div></div>

<h2 id="test-a-model"><span class="pheasant-header"><span class="header"><span class="title">Test a model</span></span></span></h2>
<p>Testing a model is as simple as training. Just call <code>run.start('test')</code> instead of a (default) <code>'train'</code> argument.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run.start(&#39;test&#39;)
run.results</code></pre></div>
<div class="report"><p><span class="count">[23]</span>
<span class="start">2020-06-01 09:54:06</span> (<span class="time">38.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3.07s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Results([&#39;train&#39;, &#39;val&#39;, &#39;test&#39;])</code></pre></div></div></div></div>

<p>As you can see, <code>test</code> results were added.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run.results.test.output[:5]</code></pre></div>
<div class="report"><p><span class="count">[24]</span>
<span class="start">2020-06-01 09:54:06</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3.08s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">array([[ 5.2870665],
       [ 8.110249 ],
       [13.204687 ],
       [11.9110775],
       [ 9.05484  ]], dtype=float32)</code></pre></div></div></div></div>

<p>Off course the target values for the test data are <code>np.nan</code>.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run.results.test.target[:5]</code></pre></div>
<div class="report"><p><span class="count">[25]</span>
<span class="start">2020-06-01 09:54:06</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3.08s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">array([[nan],
       [nan],
       [nan],
       [nan],
       [nan]], dtype=float32)</code></pre></div></div></div></div>

<h2 id="task-for-multiple-runs"><span class="pheasant-header"><span class="header"><span class="title">Task for multiple runs</span></span></span></h2>
<p>Ivory implements a special run type called <strong>Task</strong> which controls multiple nested runs. A task is useful for parameter search or cross validation.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">task = client.create_task(&#39;torch&#39;)
task</code></pre></div>
<div class="report"><p><span class="count">[26]</span>
<span class="start">2020-06-01 09:54:06</span> (<span class="time">50.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3.13s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Task(id=&#39;da555985dbdf456eb0d349845c2ada80&#39;, name=&#39;task#0&#39;, num_instances=3)</code></pre></div></div></div></div>

<p>The <code>Task</code> class has two methods to generate multiple runs: <code>Task.prodcut()</code> and <code>Task.chain()</code>. These two methods have the same functionality as <a href="https://docs.python.org/3/library/itertools.html"><code>itertools</code></a> of Python starndard library. Let's try to perform cross validation.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">runs = task.product(fold=range(4), verbose=0, epochs=3)
runs</code></pre></div>
<div class="report"><p><span class="count">[27]</span>
<span class="start">2020-06-01 09:54:06</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">3.14s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">&lt;generator object Task.product at 0x000001FA3388EDC8&gt;</code></pre></div></div></div></div>

<p>Like <code>itertools</code>'s functions, <code>Task.prodcut()</code> and <code>Task.chain()</code> return a generator, which yields runs that are configured by different parameters you specify. In this case, this generator will yield 4 runs with a fold number ranging from 0 to 3 for each. A <code>task</code> instance doesn't start any training by itself. In addtion, you can pass fixed parameters to update the original parameters in the YAML file.</p>
<p>Then start 4 runs by a <code>for</code> loop including <code>run.start('both')</code>. Here <code>'both'</code> means execution of test after training.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">for run in runs:
    run.start(&#39;both&#39;)</code></pre></div>
<div class="report"><p><span class="count">[28]</span>
<span class="start">2020-06-01 09:54:06</span> (<span class="time">2.10s</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.23s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">[run#3] epochs=3 fold=0
[run#4] epochs=3 fold=1
[run#5] epochs=3 fold=2
[run#6] epochs=3 fold=3</code></pre></div></div></div></div>

<h2 id="collect-runs"><span class="pheasant-header"><span class="header"><span class="title">Collect runs</span></span></span></h2>
<p>Our client has a <code>Tracker</code> instance. It stores the state of runs in background using MLFlow Tracking. The <code>Client</code> class provides several methods to access the stored runs. For example, <code>Client.search_run_ids()</code> returns a generator which yields RunID created by MLFlow Tracking.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python"># A helper function.
def print_run_info(run_ids):
    for run_id in run_ids:
        print(run_id[:5], client.get_run_name(run_id))</code></pre></div>
<div class="report"><p><span class="count">[29]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">3.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.24s</span>)</span></p></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run_ids = client.search_run_ids(&#39;torch&#39;)  # Yields all runs of `torch`.
print_run_info(run_ids)</code></pre></div>
<div class="report"><p><span class="count">[30]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">65.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.30s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">64f2c run#6
07612 run#5
cbc6d run#4
454a4 run#3
da555 task#0
f2261 run#2
fff8b run#1
dabd9 run#0</code></pre></div></div></div></div>

<p>For filtering, add key-value pairs.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python"># If `exclude_parent` is True, parent runs are excluded.
run_ids = client.search_run_ids(&#39;torch&#39;, fold=0, exclude_parent=True)
print_run_info(run_ids)</code></pre></div>
<div class="report"><p><span class="count">[31]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">161ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.46s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">454a4 run#3
f2261 run#2
dabd9 run#0</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python"># If `parent_run_id` is specified, nested runs having the parent are returned.
run_ids = client.search_run_ids(&#39;torch&#39;, parent_run_id=task.id)
print_run_info(run_ids)</code></pre></div>
<div class="report"><p><span class="count">[32]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">47.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.51s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">64f2c run#6
07612 run#5
cbc6d run#4
454a4 run#3</code></pre></div></div></div></div>

<p><code>Client.get_run_id()</code> and <code>Client.get_run_ids()</code> fetch RunID from run name, more strictly, (run class name in lower case) plus (run number).</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run_ids = [client.get_run_id(&#39;torch&#39;, run=0),
           client.get_run_id(&#39;torch&#39;, task=0)]
print_run_info(run_ids)</code></pre></div>
<div class="report"><p><span class="count">[33]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">57.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.57s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">dabd9 run#0
da555 task#0</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run_ids = client.get_run_ids(&#39;torch&#39;, run=range(2, 4))
print_run_info(run_ids)</code></pre></div>
<div class="report"><p><span class="count">[34]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">56.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.62s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">f2261 run#2
454a4 run#3</code></pre></div></div></div></div>

<h2 id="load-runs-and-results"><span class="pheasant-header"><span class="header"><span class="title">Load runs and results</span></span></span></h2>
<p>The <code>Client</code> instance can load runs. First select RunID(s) to load. We want to perform cross validation here, so that we need a run collection created by the <code>task#0</code>. In this case, we can use <code>Client.get_nested_run_ids()</code>. Why don't we use <code>Client.search_run_ids()</code> as we did above? Because we don't have an easy way to get a very long RunID after we restart a Python session and lose the <code>Task</code> instance. On the ohter hand, a run name is easy to manage and write.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python"># Assume that we restart a session so we have no run instances now.
run_ids = list(client.get_nested_run_ids(&#39;torch&#39;, task=0))
print_run_info(run_ids)</code></pre></div>
<div class="report"><p><span class="count">[35]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">67.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.69s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">64f2c run#6
07612 run#5
cbc6d run#4
454a4 run#3</code></pre></div></div></div></div>

<p>Let's load the latest run.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run = client.load_run(run_ids[0])
run</code></pre></div>
<div class="report"><p><span class="count">[36]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">42.3ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.73s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Run(id=&#39;64f2c1660055420dbb399b6d8a2ceecc&#39;, name=&#39;run#6&#39;, num_instances=11)</code></pre></div></div></div></div>

<p>Note that the <code>Client.load_run()</code> function doesn't require an experiment name because RunID is <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>.</p>
<p>As you expected, the fold number is 3.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run.datasets.fold</code></pre></div>
<div class="report"><p><span class="count">[37]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">3.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.73s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">3</code></pre></div></div></div></div>

<p>By loading a run, we obtain the <em>pretrained</em> model.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">run.model.eval()</code></pre></div>
<div class="report"><p><span class="count">[38]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">3.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.74s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Model(
  (layers): ModuleList(
    (0): Linear(in_features=2, out_features=20, bias=True)
    (1): Linear(in_features=20, out_features=30, bias=True)
    (2): Linear(in_features=30, out_features=1, bias=True)
  )
)</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import torch

index, input, target = run.datasets.val[:5]
with torch.no_grad():
    output = run.model(torch.tensor(input))
print(&#39;[output]&#39;)
print(output.numpy())
print(&#39;[target]&#39;)
print(target)</code></pre></div>
<div class="report"><p><span class="count">[39]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">8.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.75s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">[output]
[[15.184076]
 [14.625579]
 [10.535991]
 [10.584717]
 [ 7.760171]]
[target]
[[18.492708]
 [16.781471]
 [ 9.458517]
 [ 9.876715]
 [ 5.37973 ]]</code></pre></div></div></div></div>

<p>If you don't need a whole run instance, the <code>Client.load_instance()</code> function is a better choice to save time and memory.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">results = client.load_instance(run_ids[0], &#39;results&#39;)
results</code></pre></div>
<div class="report"><p><span class="count">[40]</span>
<span class="start">2020-06-01 09:54:08</span> (<span class="time">25.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.77s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Results([&#39;train&#39;, &#39;val&#39;, &#39;test&#39;])</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">for mode in results:  # Yield a mode.
    print(mode, results[mode].output.shape)</code></pre></div>
<div class="report"><p><span class="count">[41]</span>
<span class="start">2020-06-01 09:54:09</span> (<span class="time">8.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.78s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">train (600, 1)
val (200, 1)
test (200, 1)</code></pre></div></div></div></div>

<p>For cross validation, we need 4 runs. In order to load multiple run's results at the same time, the Ivory <code>Client</code> provides a convenient method.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">results = client.load_results(run_ids, verbose=False)  # No progress bar.
results</code></pre></div>
<div class="report"><p><span class="count">[42]</span>
<span class="start">2020-06-01 09:54:09</span> (<span class="time">88.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.87s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Results([&#39;val&#39;, &#39;test&#39;])</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">for mode, result in results.items():  # Yield a (mode, result).
    print(mode, result.output.shape)</code></pre></div>
<div class="report"><p><span class="count">[43]</span>
<span class="start">2020-06-01 09:54:09</span> (<span class="time">6.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.87s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">val (800, 1)
test (800, 1)</code></pre></div></div></div></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>Client.load_results()</code> drops train data for saving memory.</p>
</div>
<p>The lengths of validation data and test data are both 800 (200 times 4). But be careful about the test data. The length of unique samples is 200 (one fold size).</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">import numpy as np

len(np.unique(results.val.index)), len(np.unique(results.test.index))</code></pre></div>
<div class="report"><p><span class="count">[44]</span>
<span class="start">2020-06-01 09:54:09</span> (<span class="time">5.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.88s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">(800, 200)</code></pre></div></div></div></div>

<p>Usually, duplicated samples in test data are averaged for ensembling. The <code>Results.mean()</code> function performs this <em>mean reduction</em> and returns a newly created <code>Rusults</code> instance.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">reduced_results = results.mean()
for mode, result in reduced_results.items():
    print(mode, result.output.shape)</code></pre></div>
<div class="report"><p><span class="count">[45]</span>
<span class="start">2020-06-01 09:54:09</span> (<span class="time">14.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.89s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">val (800, 1)
test (200, 1)</code></pre></div></div></div></div>

<p>Compare these results.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">index = results.test.index
index_0 = index[0]
x = results.test.output[index == index_0]
print(&#39;[results]&#39;)
print(x)
print(&#34;-&gt; mean:&#34;, np.mean(x))

index = reduced_results.test.index
x = reduced_results.test.output[index == index_0]
print(&#39;[reduced_results]&#39;)
print(x)</code></pre></div>
<div class="report"><p><span class="count">[46]</span>
<span class="start">2020-06-01 09:54:09</span> (<span class="time">9.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.90s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">[results]
[[7.8368   ]
 [7.7246566]
 [7.548185 ]
 [7.937648 ]]
-&gt; mean: 7.7618227
[reduced_results]
[[7.761822]]</code></pre></div></div></div></div>

<p>For convenience, The <code>Client.load_results()</code> function has a <code>reduction</code> keyword argument.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">results = client.load_results(run_ids, reduction=&#39;mean&#39;, verbose=False)
results</code></pre></div>
<div class="report"><p><span class="count">[47]</span>
<span class="start">2020-06-01 09:54:09</span> (<span class="time">82.0ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.98s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">Results([&#39;val&#39;, &#39;test&#39;])</code></pre></div></div></div></div>

<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">for mode, result in results.items():
    print(mode, result.output.shape)</code></pre></div>
<div class="report"><p><span class="count">[48]</span>
<span class="start">2020-06-01 09:54:09</span> (<span class="time">6.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.99s</span>)</span></p></div></div><div class="cell jupyter stdout"><div class="code">
      <pre><code class="nohighlight">val (800, 1)
test (200, 1)</code></pre></div></div></div></div>

<p>A cross validation (CV) score can be calculated as follows:</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">true = results.val.target
pred = results.val.output
np.mean(np.sqrt((true - pred) ** 2))  # Use any function for your metric.</code></pre></div>
<div class="report"><p><span class="count">[49]</span>
<span class="start">2020-06-01 09:54:09</span> (<span class="time">4.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">5.99s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">2.1195478</code></pre></div></div></div></div>

<p>And we got a prediction for the test data using 4 MLP models.</p>
<div class="pheasant-fenced-code"><div class="cached"><div class="cell jupyter input"><div class="code"><pre><code class="python">results.test.output[:5]</code></pre></div>
<div class="report"><p><span class="count">[50]</span>
<span class="start">2020-06-01 09:54:09</span> (<span class="time">3.00ms</span>)
<span class="right"><span class="kernel">python3</span> (<span class="total">6.00s</span>)</span></p></div></div><div class="cell jupyter output"><div class="code"><pre><code class="nohighlight">array([[ 7.761822 ],
       [ 8.474606 ],
       [11.95775  ],
       [10.6364155],
       [ 9.352131 ]], dtype=float32)</code></pre></div></div></div></div>

<h2 id="summary"><span class="pheasant-header"><span class="header"><span class="title">Summary</span></span></span></h2>
<p>In this quickstart, we learned how to use the Ivory library to perform machine learning workflow. For more details see the Tutorial.</p></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href=".." title="Ivory Documentation"><span>Previous</span></a></div>
        <div class="next"><a href="../tutorial/data/" title="Set of Data classes"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
    <script src="../js/mkapi.js"></script>
    <script src="../js/pheasant.js"></script>
    <script src="../search/main.js"></script>
</body>

</html>